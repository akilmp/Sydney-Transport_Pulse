name: Deploy
on:
  workflow_dispatch:
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: hashicorp/setup-terraform@v3
      - run: terraform init
        working-directory: iac/terraform
      - run: terraform plan -out=tfplan
        working-directory: iac/terraform
      - run: terraform apply -input=false tfplan
        working-directory: iac/terraform
      - name: dbt docs
        run: |
          cd dbt && dbt docs generate
